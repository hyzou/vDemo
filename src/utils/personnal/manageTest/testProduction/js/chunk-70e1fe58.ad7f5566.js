(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70e1fe58"],{"01f9":function(t,e,a){"use strict";var o=a("2d00"),r=a("5ca1"),s=a("2aba"),n=a("32e9"),i=a("84f2"),l=a("41a0"),m=a("7f20"),c=a("38fd"),u=a("2b4c")("iterator"),d=!([].keys&&"next"in[].keys()),f="@@iterator",p="keys",h="values",v=function(){return this};t.exports=function(t,e,a,y,P,b,N){l(a,e,y);var g,C,I,S=function(t){if(!d&&t in $)return $[t];switch(t){case p:return function(){return new a(this,t)};case h:return function(){return new a(this,t)}}return function(){return new a(this,t)}},_=e+" Iterator",x=P==h,T=!1,$=t.prototype,k=$[u]||$[f]||P&&$[P],L=k||S(P),q=P?x?S("entries"):L:void 0,O="Array"==e&&$.entries||k;if(O&&(I=c(O.call(new t)),I!==Object.prototype&&I.next&&(m(I,_,!0),o||"function"==typeof I[u]||n(I,u,v))),x&&k&&k.name!==h&&(T=!0,L=function(){return k.call(this)}),o&&!N||!d&&!T&&$[u]||n($,u,L),i[e]=L,i[_]=v,P)if(g={values:x?L:S(h),keys:b?L:S(p),entries:q},N)for(C in g)C in $||s($,C,g[C]);else r(r.P+r.F*(d||T),e,g);return g}},"38fd":function(t,e,a){var o=a("69a8"),r=a("4bf8"),s=a("613b")("IE_PROTO"),n=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),o(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?n:null}},"41a0":function(t,e,a){"use strict";var o=a("2aeb"),r=a("4630"),s=a("7f20"),n={};a("32e9")(n,a("2b4c")("iterator"),function(){return this}),t.exports=function(t,e,a){t.prototype=o(n,{next:r(1,a)}),s(t,e+" Iterator")}},"7f7f":function(t,e,a){var o=a("86cc").f,r=Function.prototype,s=/^\s*function ([^ (]*)/,n="name";n in r||a("9e1e")&&o(r,n,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(t){return""}}})},"9c6c":function(t,e,a){var o=a("2b4c")("unscopables"),r=Array.prototype;void 0==r[o]&&a("32e9")(r,o,{}),t.exports=function(t){r[o][t]=!0}},ac4d:function(t,e,a){a("3a72")("asyncIterator")},ac6a:function(t,e,a){for(var o=a("cadf"),r=a("0d58"),s=a("2aba"),n=a("7726"),i=a("32e9"),l=a("84f2"),m=a("2b4c"),c=m("iterator"),u=m("toStringTag"),d=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),h=0;h<p.length;h++){var v,y=p[h],P=f[y],b=n[y],N=b&&b.prototype;if(N&&(N[c]||i(N,c,d),N[u]||i(N,u,y),l[y]=d,P))for(v in o)N[v]||s(N,v,o[v],!0)}},cadf:function(t,e,a){"use strict";var o=a("9c6c"),r=a("d53b"),s=a("84f2"),n=a("6821");t.exports=a("01f9")(Array,"Array",function(t,e){this._t=n(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,a=this._i++;return!t||a>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?a:"values"==e?t[a]:[a,t[a]])},"values"),s.Arguments=s.Array,o("keys"),o("values"),o("entries")},d011:function(t,e,a){"use strict";a.r(e);a("7f7f"),a("cadf"),a("ac4d"),a("ac6a");var o={name:"addTemperatureEquipment",components:{myheader:function(){return a.e("chunk-2325facc").then(a.bind(null,"8c2e"))},mySelect:function(){return a.e("chunk-2d0f0109").then(a.bind(null,"9b7a"))}},data:function(){return{saveCannotClick:!1,numberTypeFormKey:[{key:"lineNumbers",formChildName:"customParameters",formName:"线缆数量"},{key:"pointNumPerLine",formChildName:"customParameters",formName:"每根线缆点位数量"},{key:"startLineNo",formChildName:"customParameters",formName:"起始线缆号"},{key:"temHumlineNo1",formChildName:"customParameters",formName:"仓温仓湿1线缆号"},{key:"temHumlineNo2",formChildName:"customParameters",formName:"仓温仓湿2线缆号"}],requiredFormKey:[{key:"controllerName",formName:"分机名"},{key:"connectionType",formName:"连接类型"},{key:"protocolType",formName:"协议类型"},{key:"lineNumbers",formName:"线缆数量",formChildName:"customParameters"},{key:"pointNumPerLine",formName:"每根线缆点位数量",formChildName:"customParameters"},{key:"startLineNo",formName:"起始线缆号",formChildName:"customParameters"}],showSerial:!1,headerOptionSettings:{hideleft:!1,title:"测温分机",routePath:this.$route.query.eqpId?"home":"selectEqumentType"},connectTpyeOptionSettings:{cellTitle:"连接类型",cellIcon:"",cellValue:"请选择▼",valueKey:"label",slots:[{flex:1,values:this.$store.getters.connectTpyeDatas,className:"slot1",textAlign:"center",defaultIndex:0}]},serialPortOptionSettings:{cellTitle:"串口",cellIcon:"",cellValue:"请选择▼",valueKey:"label",slots:[{flex:1,values:this.$store.getters.serialPortDatas,className:"slot1",textAlign:"center",defaultIndex:0}]},protocolOptionSettings:{cellTitle:"协议类型",cellIcon:"",cellValue:"请选择▼",valueKey:"label",slots:[{flex:1,values:this.$store.getters.protocolDatas[this.$route.query.testType],className:"slot1",textAlign:"center",defaultIndex:0}]},controllerId:this.$route.query.eqpId?this.$route.query.eqpId:"",formdata:{storePointId:this.$store.getters.userInfo.storePointId,controllerId:this.controllerId,channelParameter:"",testType:this.$route.query.testEquipment,controllerName:"",connectionType:"tcp",connectTpye_dsc:"",serialPort:"",serialPort_dsc:"",host:"",port:"",protocolType:"",protocol_dsc:"",ModbusAddress:"",protocolParameter:{},customParameters:{},controllerType:this.$route.query.testType},paramlist:[],protocolParams:null}},methods:{handleCommentFocus:function(){this.saveCannotClick=!0},handleGetConnectTpyeValue:function(t){var e=this;e.formdata.connectionType=t[0].value,e.connectTpyeOptionSettings.cellValue=t[0].label+"▼",e.formdata.connectTpye_dsc=t[0].label},handleGetProtocolValue:function(t){var e=this;setTimeout(function(){e.formdata.protocolType=t[0].value,e.protocolOptionSettings.cellValue=t[0].label+"▼",e.formdata.protocol_dsc=t[0].label,e.formdata.protocolParameter={},e.paramlist=e.$store.getters.protocolParamsDatas[t[0].value].paramList,e.paramlist.map(function(t){e.protocolParams&&e.protocolParams[t.paramName]?e.formdata.protocolParameter[t.paramName]=e.protocolParams[t.paramName]:e.formdata.protocolParameter[t.paramName]||(e.formdata.protocolParameter[t.paramName]="")})},100)},handleGetSerialPortValue:function(t){var e=this;e.formdata.serialPort=t[0].value,e.serialPortOptionSettings.cellValue=t[0].label+"▼",e.formdata.serialPort_dsc=t[0].label},handleSaveEqpInfo:function(t){var e=this,a=/^([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/,o=/^(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}$/;if("serial"==this.formdata.connectionType){if(this.formdata.host="localhost",this.formdata.port=this.formdata.serialPort,!this.formdata.port)return this.$messagebox.alert("请完善必填项port","提示"),!1}else{if(!this.formdata.port||!this.formdata.host)return this.$messagebox.alert("请完善必填项host,port","提示"),!1;if(!a.test(this.formdata.port))return this.$messagebox.alert("端口号只能填写数字","提示"),!1;if(!o.test(this.formdata.host))return this.$messagebox.alert("IP地址格式校验不通过","提示"),!1}for(var r in this.formdata.protocolParameter)this.formdata.protocolParameter[r]||delete this.formdata.protocolParameter[r];var s=!0,n=!1,i=void 0;try{for(var l,m=this.paramlist[Symbol.iterator]();!(s=(l=m.next()).done);s=!0){var c=l.value;if(!this.formdata.protocolParameter[c.paramName]&&"true"==c.paramRequired)return this.$messagebox.alert("请完善必填项"+c.paramName,"提示"),!1}}catch(_){n=!0,i=_}finally{try{s||null==m.return||m.return()}finally{if(n)throw i}}var u=!0,d=!1,f=void 0;try{for(var p,h=this.requiredFormKey[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var v=p.value;if(v.formChildName){if(!this.formdata[v.formChildName][v.key])return this.$messagebox.alert("请完善必填项","提示"),!1}else if(!this.formdata[v.key])return this.$messagebox.alert("请完善必填项","提示"),!1}}catch(_){d=!0,f=_}finally{try{u||null==h.return||h.return()}finally{if(d)throw f}}var y=!0,P=!1,b=void 0;try{for(var N,g=this.numberTypeFormKey[Symbol.iterator]();!(y=(N=g.next()).done);y=!0){var C=N.value;if(C.formChildName&&this.formdata[C.formChildName][C.key]&&!a.test(this.formdata[C.formChildName][C.key]))return this.$messagebox.alert(C.formName+"只能填写数字","提示"),!1}}catch(_){P=!0,b=_}finally{try{y||null==g.return||g.return()}finally{if(P)throw b}}if(this.formdata.customParameters.lineNumbers&&this.formdata.customParameters.pointNumPerLine&&this.formdata.customParameters.lineNumbers*this.formdata.customParameters.pointNumPerLine>20)this.$messagebox.alert("一次最多可提交20个测温点,请修改后重新提交");else{var I="",S={};this.$route.query.eqpId?(I=this.$api.updateControllerConfig,S.testControllerDto=this.formdata,S.controllerId=this.controllerId):(I=this.$api.saveControllerConfig,S=this.formdata),this.$postData(I,S).then(function(a){e.controllerId=a.data,"save"==t?e.$router.push("home"):e.getStoreGateWayInfo()})}},getControllerConfig:function(){var t=this;this.$postData(this.$api.getControllerConfig,{controllerId:this.$route.query.eqpId,storePointId:this.$store.getters.userInfo.storePointId}).then(function(e){e.data.controllerId=t.$route.query.eqpId?t.$route.query.eqpId:"",e.data.channelParameter="",t.formdata=e.data.testControllerDto,t.protocolParams=e.data.testControllerDto.protocolParameter,t.controllerId=e.data.controllerId,"serial"===t.formdata.connectionType&&(t.formdata.serialPort=t.formdata.port,t.formdata.port="");for(var a=0;a<t.connectTpyeOptionSettings.slots[0].values.length;a++)if(t.connectTpyeOptionSettings.slots[0].values[a].value==t.formdata.connectionType){t.connectTpyeOptionSettings.slots[0].defaultIndex=a;break}for(var o=0;o<t.serialPortOptionSettings.slots[0].values.length;o++)if(t.serialPortOptionSettings.slots[0].values[o].value==t.formdata.serialPort){t.serialPortOptionSettings.slots[0].defaultIndex=o;break}for(var r=0;r<t.protocolOptionSettings.slots[0].values.length;r++)if(t.protocolOptionSettings.slots[0].values[r].value==t.formdata.protocolType){t.protocolOptionSettings.slots[0].defaultIndex=r;break}setTimeout(function(){t.saveCannotClick=!1},500)})},getStoreGateWayInfo:function(){var t=this;this.$getData(this.$api.getStoreGateWayInfo,{storepointId:this.$store.getters.userInfo.storePointId}).then(function(e){if(0!=e.data.length){var a=e.data.filter(function(t){if(!t.storehouseId)return!0});0!=a.length?(t.formdata.gatewayInfo=a[0],t.getConnectController(t.formdata)):t.$messagebox.alert("该库区未检测到可用的网关配置")}else t.$messagebox.alert("该库区未检测到网关配置")})},getConnectController:function(t){var e=this,a="",o=t.protocolParameter,r=[];a="tcp"==t.connectionType?t.protocolType+"://"+t.host+":"+t.port:"jhrtu://"+t.host+":"+t.port;for(var s=0;s<this.formdata.customParameters.lineNumbers;s++)for(var n=1;n<=this.formdata.customParameters.pointNumPerLine;n++){var i={};i.vid="t_l"+(parseInt(this.formdata.customParameters.startLineNo)+s)+"p"+(n+1),i.offset=100*(parseInt(this.formdata.customParameters.startLineNo)+s)+n,i.vtypeName="short",i.sectorName="GRAIN_TEMP",r.push(i)}this.formdata.customParameters.temHumlineNo1&&(r.push({offset:100*parseInt(this.formdata.customParameters.temHumlineNo1)+1,vid:"ht_l"+this.formdata.customParameters.temHumlineNo1+"p1",sectorName:"HOUSE_TEMP",vtypeName:"short"}),r.push({offset:100*parseInt(this.formdata.customParameters.temHumlineNo1)+1,vid:"hh_l"+this.formdata.customParameters.temHumlineNo1+"p1",sectorName:"HOUSE_HUM",vtypeName:"uint16"})),this.formdata.customParameters.temHumlineNo2&&(r.push({offset:100*parseInt(this.formdata.customParameters.temHumlineNo2)+1,vid:"ht_l"+this.formdata.customParameters.temHumlineNo2+"p1",sectorName:"HOUSE_TEMP",vtypeName:"short"}),r.push({offset:100*parseInt(this.formdata.customParameters.temHumlineNo2)+1,vid:"hh_l"+this.formdata.customParameters.temHumlineNo2+"p1",sectorName:"HOUSE_HUM",vtypeName:"uint16"}));var l={ctrDto:{ctrlId:this.controllerId,chUrl:a,vars:r,compactibilities:o},gwDto:{id:t.gatewayInfo.hwSysId,name:t.gatewayInfo.name}};this.$postData(this.$api.connectController,l,!0).then(function(t){t&&t.data?e.$router.push({path:"temperatureResult",query:{eqpId:e.controllerId,gwDto:l.gwDto}}):e.$messagebox.alert("控制器建立失败")})}},watch:{formdata:{handler:function(){this.saveCannotClick=!0},deep:!0}},mounted:function(){var t=this;this.$route.query.eqpId?this.getControllerConfig():setTimeout(function(){t.saveCannotClick=!1},500)}},r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"manage"},[a("myheader",{attrs:{myheaderOption:t.headerOptionSettings}}),t._v(" "),a("div",{staticClass:"bgfff"},[a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{attrs:{label:"分机名",placeholder:"请输入分机名"},model:{value:t.formdata.controllerName,callback:function(e){t.$set(t.formdata,"controllerName",e)},expression:"formdata.controllerName"}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mySelect",{attrs:{mySelectOption:t.connectTpyeOptionSettings},on:{myselectChange:t.handleGetConnectTpyeValue}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mySelect",{directives:[{name:"show",rawName:"v-show",value:"tcp"!==t.formdata.connectionType,expression:"formdata.connectionType !== 'tcp'"}],attrs:{mySelectOption:t.serialPortOptionSettings},on:{myselectChange:t.handleGetSerialPortValue}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{directives:[{name:"show",rawName:"v-show",value:"tcp"==t.formdata.connectionType,expression:"formdata.connectionType == 'tcp'"}],attrs:{label:"IP地址",placeholder:"请输入分机地址"},model:{value:t.formdata.host,callback:function(e){t.$set(t.formdata,"host",e)},expression:"formdata.host"}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{directives:[{name:"show",rawName:"v-show",value:"tcp"==t.formdata.connectionType,expression:"formdata.connectionType == 'tcp'"}],attrs:{label:"端口",placeholder:"请输入端口"},model:{value:t.formdata.port,callback:function(e){t.$set(t.formdata,"port",e)},expression:"formdata.port"}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mySelect",{attrs:{mySelectOption:t.protocolOptionSettings},on:{myselectChange:t.handleGetProtocolValue}})],1),t._v(" "),t._l(t.paramlist,function(e){return a("div",{key:e.paramName,staticClass:"positionRel"},["true"==e.paramRequired?a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("\n        *\n      ")]):t._e(),t._v(" "),a("mt-field",{attrs:{label:e.paramDesc,placeholder:"请输入"},nativeOn:{"!focus":function(e){return t.handleCommentFocus(e)}},model:{value:t.formdata.protocolParameter[e.paramName],callback:function(a){t.$set(t.formdata.protocolParameter,e.paramName,a)},expression:"formdata.protocolParameter[param.paramName]"}})],1)}),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{attrs:{label:"线缆数量",placeholder:"请输入线缆数量"},model:{value:t.formdata.customParameters.lineNumbers,callback:function(e){t.$set(t.formdata.customParameters,"lineNumbers",e)},expression:"formdata.customParameters.lineNumbers"}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{attrs:{label:"每根线缆点位数量",placeholder:"请输入线缆数量"},model:{value:t.formdata.customParameters.pointNumPerLine,callback:function(e){t.$set(t.formdata.customParameters,"pointNumPerLine",e)},expression:"formdata.customParameters.pointNumPerLine"}})],1),t._v(" "),a("div",{staticClass:"positionRel"},[a("span",{staticClass:"positionAbs text-danger symbolRequired"},[t._v("*")]),t._v(" "),a("mt-field",{attrs:{label:"起始线缆号",placeholder:"请输入起始线缆号"},model:{value:t.formdata.customParameters.startLineNo,callback:function(e){t.$set(t.formdata.customParameters,"startLineNo",e)},expression:"formdata.customParameters.startLineNo"}})],1),t._v(" "),a("mt-field",{attrs:{label:"仓温仓湿1线缆号（选填）",placeholder:"请输入线缆号"},model:{value:t.formdata.customParameters.temHumlineNo1,callback:function(e){t.$set(t.formdata.customParameters,"temHumlineNo1",e)},expression:"formdata.customParameters.temHumlineNo1"}}),t._v(" "),a("mt-field",{attrs:{label:"仓温仓湿2线缆号（选填）",placeholder:"请输入线缆号"},model:{value:t.formdata.customParameters.temHumlineNo2,callback:function(e){t.$set(t.formdata.customParameters,"temHumlineNo2",e)},expression:"formdata.customParameters.temHumlineNo2"}})],2),t._v(" "),a("div",{staticClass:"largeBtnContainer mt10 mb10"},[a("mt-button",{attrs:{size:"large",type:"primary",disabled:!t.saveCannotClick},nativeOn:{click:function(e){return t.handleSaveEqpInfo("save")}}},[t._v("\n      保存并返回\n    ")])],1),t._v(" "),a("div",{staticClass:"largeBtnContainer"},[a("mt-button",{attrs:{size:"large",type:"primary"},nativeOn:{click:function(e){return t.handleSaveEqpInfo("test")}}},[t._v("\n      下一步\n    ")])],1)],1)},s=[],n=a("2455"),i=!1,l=null,m=null,c=null,u=Object(n["a"])(o,r,s,i,l,m,c);e["default"]=u.exports},d53b:function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}}}]);